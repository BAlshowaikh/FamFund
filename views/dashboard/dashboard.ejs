<%
  const hasGoals = activeGoals && activeGoals.length > 0;
%>

<div class="row g-4">
  <!-- Left: Family + Goals -->
  <div class="col-lg-8 d-flex flex-column gap-4">

    <!-- Family section -->
    <section class="ff-section">
      <h2 class="ff-section-title mb-3">Family</h2>

      <% if (familyMembers && familyMembers.length) { %>
        <div class="d-flex flex-wrap gap-4">
          <% familyMembers.forEach(member => { %>
            <div class="ff-family-pill text-center">
              <div class="ff-family-avatar">
                <i class="bi bi-person-fill"></i>
              </div>
              <div class="ff-family-name">
                <%= member.username || 'Username' %> <span> | </span> <%= member.role || 'Role' %>
              </div>
            </div>
          <% }) %>
        </div>
      <% } else { %>
        <p class="text-muted mb-0">
          You haven’t added any family members yet.
        </p>
      <% } %>
    </section>

    <!-- Goals section -->
    <section class="ff-section">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h2 class="ff-section-title mb-0">Active Goals</h2>
        <a href="/goals" class="text-decoration-none small text-muted">
          View all
        </a>
      </div>

      <div class="ff-goals-list mb-1">
        <% if (hasGoals) { %>
          <% activeGoals.forEach(activeGoal => { %>
            <%- include("../partials/goal/_goalSummaryCard.ejs", { activeGoal }) %>
          <% }) %>
        <% } else { %>
          <p class="text-muted mt-2 mb-0">
            You don’t have any goals yet. Start by adding your first family goal!
          </p>
        <% } %>
      </div>
    </section>
  </div>

  <!-- Right: Analysis -->
  <div class="col-lg-4">
    <section class="ff-section ff-analytics-panel">
      <h2 class="ff-section-title mb-3">Analysis</h2>

      <!-- Active goals -->
      <div class="ff-analytics-card">
        <div class="ff-analytics-label">Active Goals</div>
        <div class="ff-analytics-value"><%= totalActiveGoals %></div>
        <div class="ff-analytics-sub">
          out of <%= totalGoals %> total goals
        </div>
      </div>

      <!-- Total Contributions (placeholder until you wire real stats) -->
      <div class="ff-analytics-card">
        <div class="ff-analytics-label">Total Contributions</div>
        <div class="ff-analytics-value">
          <%= (typeof totalContributions !== "undefined") ? totalContributions : 0 %> BD
        </div>
        <div class="ff-analytics-sub">
          this month
        </div>
      </div>

      <!-- Average Contributions (placeholder) -->
      <!-- <div class="ff-analytics-card">
        <div class="ff-analytics-label">Average Contributions</div>
        <div class="ff-analytics-value">
          <%= (typeof avgContributionBD !== "undefined") ? avgContributionBD : 0 %> BD
        </div>
        <div class="ff-analytics-sub">
          over the past 6 weeks
        </div>
      </div> -->
    </section>
  </div>
</div>
